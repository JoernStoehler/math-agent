# Math Agent Benchmarking System

A minimal web dashboard for running and monitoring AI agent benchmarks on mathematical exercises. Built with Flask for simplicity and designed to handle ~50 total jobs for a small team.

## Overview

This system allows users to submit mathematical exercises to AI agents (Claude models) for automated solution generation. The web interface provides job submission, status monitoring, and access to generated solutions.

## Features

### 1. Web Dashboard (http://localhost:5000/)
- **Real-time job monitoring** with auto-refresh every 5 seconds
- **Status visualization** with color-coded rows:
  - ðŸŸ¢ Green: Completed jobs
  - ðŸŸ¡ Yellow: Running jobs
  - ðŸ”´ Red: Failed jobs
  - âšª Gray: Scheduled jobs
- **Direct file access** to exercises, prompts, logs, and solutions
- **Clean, responsive design** optimized for quick job tracking

### 2. Job Submission Form (/submit)
- **Exercise selection** from available .tex files
- **Model selection**:
  - claude-sonnet-4 (default)
  - claude-opus-4
  - claude-haiku-3
- **Configurable max turns** (1-200)
- **Prompt management**:
  - Use existing prompts (v2, v3, v4, etc.)
  - Create new prompts on-the-fly
  - Live prompt preview for existing prompts
- **Validation** with clear error messages

### 3. Job Management
- **Automatic job ID generation**: `{exercise}.{model}.{prompt}.{timestamp}`
- **Concurrent job limiting**: Maximum 5 jobs running simultaneously
- **Fire-and-forget execution**: Jobs run independently
- **Status tracking**: scheduled â†’ running â†’ completed/failed
- **Non-blocking process spawning** with background status updates

### 4. File Serving (/files/*)
- **Directory browsing** for exercises, prompts, and jobs
- **Direct file access** with proper MIME types
- **Fallback to local serving** if file server is unavailable

## Project Structure

```
math-agent/
â”œâ”€â”€ server.py              # Main Flask application (single file)
â”œâ”€â”€ README.md              # This documentation
â”œâ”€â”€ SPECIFICATION.md       # Original project specification
â”œâ”€â”€ exercises/             # Mathematical exercises (.tex files)
â”‚   â”œâ”€â”€ simple_addition.tex
â”‚   â”œâ”€â”€ example1.tex
â”‚   â””â”€â”€ ...
â”œâ”€â”€ prompts/               # Agent instruction prompts
â”‚   â”œâ”€â”€ v2/
â”‚   â”‚   â”œâ”€â”€ prompt.md
â”‚   â”‚   â””â”€â”€ agent.sh
â”‚   â”œâ”€â”€ v3/
â”‚   â”‚   â”œâ”€â”€ prompt.md
â”‚   â”‚   â””â”€â”€ agent.sh
â”‚   â””â”€â”€ ...
â””â”€â”€ jobs/                  # Job execution directories
    â””â”€â”€ {job_id}/
        â”œâ”€â”€ workspace/     # Agent working directory
        â”‚   â”œâ”€â”€ prompt.md
        â”‚   â”œâ”€â”€ exercise.tex
        â”‚   â”œâ”€â”€ solution.tex    # Generated by agent
        â”‚   â””â”€â”€ solution.pdf    # Compiled output
        â”œâ”€â”€ status.json    # Job status tracking
        â””â”€â”€ log.jsonl      # Execution logs
```

## Installation & Setup

### Prerequisites
- Python 3.8+
- Flask (`pip install flask requests`)

### Local Development

1. **Install dependencies:**
   ```bash
   pip install flask requests
   ```

2. **Start the web server:**
   ```bash
   python server.py
   ```
   The server will run on http://localhost:5000/

3. **(Optional) Start file server for static content:**
   ```bash
   python -m http.server 8001
   ```

### Public Access via Cloudflare Tunnel

1. **Install cloudflared:**
   ```bash
   wget https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64.deb
   sudo dpkg -i cloudflared-linux-amd64.deb
   ```

2. **Create tunnel (one-time setup):**
   ```bash
   cloudflared tunnel login
   cloudflared tunnel create math-agent
   cloudflared tunnel route dns math-agent math-agent.joernstoehler.com
   ```

3. **Run tunnel:**
   ```bash
   cloudflared tunnel run --url http://localhost:5000 math-agent
   ```

4. **Access URLs:**
   - Local: http://localhost:5000/
   - Public: https://math-agent.joernstoehler.com/

## Usage

### Submitting a Job

1. Navigate to http://localhost:5000/submit
2. Select an exercise from the dropdown
3. Choose the AI model to use
4. Set maximum turns (conversation rounds)
5. Either select an existing prompt or create a new one
6. Click "Submit Job"

### Monitoring Jobs

- The dashboard automatically refreshes every 5 seconds
- Click on job components to access:
  - Exercise source files
  - Prompt instructions
  - Execution logs
  - Generated solutions (when available)

### Creating New Prompts

When submitting a job, you can create new prompts:
1. Select "Create New Prompt" in the prompt dropdown
2. Enter a unique prompt name (e.g., "v5")
3. Write the prompt instructions in the text area
4. The prompt will be saved and available for future jobs

## API Endpoints

- `GET /` - Dashboard with all jobs
- `GET /submit` - Job submission form
- `POST /submit` - Create new job
- `GET /files/*` - Serve static files
- `GET /get_prompt_content?prompt={name}` - AJAX endpoint for prompt preview

## Technical Details

### Job Execution Flow

1. User submits job via web form
2. Server creates job directory with unique ID
3. Exercise and prompt files are copied to workspace
4. Agent process is spawned in background
5. Status is tracked in `status.json`
6. Logs are written to `log.jsonl`
7. Agent generates solution files
8. Status updates to completed/failed

### Concurrent Job Management

- Uses `ps aux | grep "agent.sh"` to count running processes
- Enforces maximum of 5 concurrent jobs
- Returns clear error message when limit is reached

### Error Handling

- Form validation for required fields
- File existence checks
- Process spawning error catching
- User-friendly error messages

## Testing with curl

```bash
# View dashboard
curl http://localhost:5000/

# Submit a job
curl -X POST http://localhost:5000/submit \
  -d "exercise=simple_addition.tex" \
  -d "model=claude-sonnet-4" \
  -d "max_turns=10" \
  -d "prompt_type=existing" \
  -d "existing_prompt=v2"

# Access files
curl http://localhost:5000/files/exercises/simple_addition.tex
```

## Performance Notes

- Directory scanning is efficient for <100 jobs
- No database or caching needed at this scale
- Auto-refresh provides near real-time updates
- File serving is handled efficiently

## Security Considerations

- No authentication implemented (trusted team environment)
- File access is read-only through the web interface
- Process isolation through separate working directories
- No remote code execution capabilities

## Future Enhancements (Out of Scope)

- Job persistence across server restarts
- Live log streaming
- Advanced scheduling algorithms
- User authentication and permissions
- Database backend for larger scale
- Metrics and analytics dashboard

## Troubleshooting

### Jobs show as "failed" immediately
- Check that agent.sh exists in the prompt directory
- Verify file permissions are correct
- Check log files for specific errors

### "Maximum concurrent jobs reached" error
- Wait for running jobs to complete
- Check for stuck processes: `ps aux | grep agent.sh`
- Kill stuck processes if necessary

### File not found errors
- Ensure exercises/ and prompts/ directories exist
- Verify file extensions (.tex for exercises, .md for prompts)
- Check file permissions

## License

This project is part of the Math Agent benchmarking system for academic research.